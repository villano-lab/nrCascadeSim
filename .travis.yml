jobs:
   include:
    # see mac images: https://docs.travis-ci.com/user/reference/osx/
    # more recent build envs:  https://changelog.travis-ci.com/
    - os: osx
      osx_image: xcode11.4 
      env:  ROOTDIST="root_v6.20.00.macosx64-10.15-clang110.tar.gz"
      language: generic 
      python: 3.7
    - os: osx
      osx_image: xcode12 
      env:  ROOTDIST="root_v6.24.06.macos-10.15-x86_64-clang120.tar.gz"
      language: generic 
      python: 3.7
    - os: osx
      osx_image: xcode13.1 
      env:  ROOTDIST="root_v6.24.06.macos-11.5-x86_64-clang120.tar.gz"
      language: generic 
      python: 3.7
    - os: linux
      dist: xenial
      env:  ROOTDIST="root_v6.20.00.Linux-ubuntu16-x86_64-gcc5.4.tar.gz"
      language: python
      python: 3.7
    - os: linux
      dist: bionic
      env:  ROOTDIST="root_v6.20.00.Linux-ubuntu18-x86_64-gcc7.4.tar.gz"
      language: python
      python: 3.7
    - os: linux
      dist: xenial
      env:  ROOTDIST="root_v6.24.06.Linux-ubuntu16-x86_64-gcc5.4.tar.gz"
      language: python
      python: 3.7
    - os: linux
      dist: bionic
      env:  ROOTDIST="root_v6.24.06.Linux-ubuntu18-x86_64-gcc7.5.tar.gz"
      language: python
      python: 3.7
    - os: linux
      dist: focal 
      env:  ROOTDIST="root_v6.24.06.Linux-ubuntu20-x86_64-gcc9.3.tar.gz"
      language: python
      python: 3.7
    - os: windows
      language: python
      python: 3.7

install:
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then curl -L -o ubuntu-1804.zip https://aka.ms/wsl-ubuntu-1804; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then powershell.exe -NoProfile -Command "Expand-Archive -Path ubuntu-1804.zip -DestinationPath Ubuntu"; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then Ubuntu/ubuntu1804.exe install --root; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then wsl.exe apt update; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then wsl.exe apt install -y python3-pip; fi
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then wsl; fi
  - source activate piptest
  - if [ "$TRAVIS_OS_NAME" = "windows" ]; then conda install -c conda-forge root
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; echo "installing..."; fi
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; echo $ROOTDIST; fi
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; echo "wget command..."; fi
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; echo "wget https://root.cern/download/"$ROOTDIST; fi
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; then wget https://root.cern/download/$ROOTDIST; fi
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; then tar -xzf $ROOTDIST; fi
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; then source root/bin/thisroot.sh; fi
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; echo "root libraries.."; fi
  - if [ "$TRAVIS_OS_NAME" != "windows" ]; echo `root-config --cflags --glibs`; fi
  - root --version
  - sudo chmod 777 .travis/install.sh
  - ls -lh .travis/install.sh
  - source .travis/install.sh

  # install and set up lcov
  - wget http://downloads.sourceforge.net/ltp/lcov-1.14.tar.gz
  - tar -zxvf lcov-1.14.tar.gz
  - cd lcov-1.14
  - sudo make install
  - cd ../
  - lcov --directory ./ --zerocounters

  # give self permission to run scripts
  - sudo chmod 777 tests/test_realizeCascades.sh
  - sudo chmod 777 get_checksums.sh

script:
  #make repository code (my code)
  - make
  - sudo make install
  - make tests

  # activate conda environment
  - source activate piptest

  # test help functions
  - realizeCascades --help
  - regexPlayground --help

  #do the tests
  - cd tests
  - ./test_realizeCascades.sh
  - bash test_examples.sh
  - regexPlayground
  - realizeCascades -n 1 -o "verbosetest.root" ../levelfiles/allge_ngam_WSlow.txt

  #need conda environment
  - cd ../example-usecase
  - realizeCascades -n 10000 -o data/Gefile.root ../levelfiles/allge_ngam_WSlow.txt
  - realizeCascades -n 10000 -o data/Nefile.root ../levelfiles/20ne_ngam.txt
  - realizeCascades -n 10000 -o data/Arfile.root ../levelfiles/40ar_ngam.txt
  - travis_wait 50 py.test

  #clean up
  - cd ../
  - sudo make clean

# Send coverage info to codecov
after_success: 
  - if [ "$UPLOAD_COVERAGE" == "true" ]; then source .travis/uploadtocodecov.sh; fi
