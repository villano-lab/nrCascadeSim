jobs:
   include:
    # see mac images: https://docs.travis-ci.com/user/reference/osx/
    # more recent build envs:  https://changelog.travis-ci.com/
    - os: osx
      osx_image: xcode11.4 
      env:  ROOTDIST="root_v6.20.00.macosx64-10.15-clang110.tar.gz"; BUILDLINE=2
      language: generic 
      python: 3.7
    - os: osx
      osx_image: xcode12 
      env:  ROOTDIST="root_v6.24.06.macos-10.15-x86_64-clang120.tar.gz"; BUILDLINE=472
      language: generic 
      python: 3.7
    - os: osx
      osx_image: xcode13.1 
      env:  ROOTDIST="root_v6.24.06.macos-11.5-x86_64-clang120.tar.gz"; BUILDLINE=539
      language: generic 
      python: 3.7
    - os: linux
      dist: xenial
      env:  ROOTDIST="root_v6.20.00.Linux-ubuntu16-x86_64-gcc5.4.tar.gz"; BUILDLINE=203
      language: python
      python: 3.7
    - os: linux
      dist: bionic
      env:  ROOTDIST="root_v6.20.00.Linux-ubuntu18-x86_64-gcc7.4.tar.gz"; BUILDLINE=270
      language: python
      python: 3.7
    - os: linux
      dist: xenial
      env:  ROOTDIST="root_v6.24.06.Linux-ubuntu16-x86_64-gcc5.4.tar.gz"; BUILDLINE=606; UPLOAD_COVERAGE="true"
      language: python
      python: 3.7
    - os: linux
      dist: bionic
      env:  ROOTDIST="root_v6.24.06.Linux-ubuntu18-x86_64-gcc7.5.tar.gz"; BUILDLINE=673
      language: python
      python: 3.7
    - os: linux
      dist: focal 
      env:  ROOTDIST="root_v6.24.06.Linux-ubuntu20-x86_64-gcc9.3.tar.gz"; BUILDLINE=740
      language: python
      python: 3.7

install:
   - pwd
   - sudo chmod 777 .travis/install.sh
   - ls -lh .travis/install.sh
   - source .travis/install.sh

   - echo "installing..."
   - echo $ROOTDIST
   - echo "wget command..." 
   - echo "wget https://root.cern/download/"$ROOTDIST 
   - wget https://root.cern/download/$ROOTDIST 
   - tar -xzf $ROOTDIST 
   - source root/bin/thisroot.sh
   - echo "root libraries.."
   - echo `root-config --cflags --glibs`
   - ls -lh ~/build/villano-lab/nrCascadeSim/root/lib
   - echo $LD_LIBRARY_FLAGS

   # install and set up lcov
   - wget http://downloads.sourceforge.net/ltp/lcov-1.14.tar.gz
   - tar -zxvf lcov-1.14.tar.gz
   - cd lcov-1.14
   - sudo make install
   - cd ../
   - lcov --directory ./ --zerocounters

   # give self permission to run scripts
   - sudo chmod 777 tests/test_realizeCascades.sh
   - sudo chmod 777 get_checksums.sh

   # set up build dir
   - mkdir ~/build/nrCascadeSim_build
   - cd ~/build/nrCascadeSim_build

script:
  #make repository code (my code)
  - cmake -DCMAKE_INSTALL_PREFIX=/usr/local -DUSE_GCOV=ON ~/build/villano-lab/nrCascadeSim
  - make VERBOSE=1
  - sudo make install
  - make tests
  # Send tests to directory they were written to run from.
  - mv readLevelfile ~/build/villano-lab/nrCascadeSim/tests/bin
  - mv realizeAndSave ~/build/villano-lab/nrCascadeSim/tests/bin
  - mv printIsotopeInfo ~/build/villano-lab/nrCascadeSim/tests/bin
  - mv fetchYieldModel ~/build/villano-lab/nrCascadeSim/tests/bin
  - cd ~/build/villano-lab/nrCascadeSim/

  # activate conda environment
  - source activate piptest

  # test help functions
  - realizeCascades --help
  - regexPlayground --help

  #do the tests
  - cd tests
  - ./test_realizeCascades.sh
  - bash test_examples.sh
  - regexPlayground
  - realizeCascades -n 1 -o "verbosetest.root" ../levelfiles/allge_ngam_WSlow.txt

  #need conda environment
  - cd ../example-usecase
  - travis_wait 50 py.test

  #Upload coverage before relevant data is removed.
  - if [ "$UPLOAD_COVERAGE" == "true" ]; then source ~/build/villano-lab/nrCascadeSim/.travis/uploadtocodecov.sh; fi

  #clean up
  - cd ~/build/nrCascadeSim_build
  - make clean
  - sudo make uninstall
